(() => {
  'use strict';

  angular
    .module('<%= moduleName %>')
    .component('<%= widgetComponentName %>', {
      templateUrl: ':::PLUGIN_PATH:::/widget.html',
      bindings: {
        config: '<'
      },
      controllerAs: 'vm',
      controller: Controller
    });

  /* @ngInject */
  function Controller(
    this: angular.IController,
    $rootScope: angular.IRootScopeService,
    <%= widgetDataServiceName %>: any
  ) {
    const vm = this;

    _.assign(vm, {
      $onChanges
    });

    ////////////

    function $onChanges({ config }: angular.IOnChangesObject) {
      if (config) {
        onConfigChange(vm.config);
      }
    }

    async function onConfigChange(config: any) {
      const deviceId = _.get(config, 'device.id');

      if (deviceId) {
        vm.data = await <%= widgetDataServiceName %>.getDataFor({ source: deviceId });
      }

      $rootScope.$apply();
    }
  }
})();
